<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>맞춤형 설교 작성 - SermonNote</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: linear-gradient(135deg, #232526 0%, #414345 100%);
      min-height: 100vh;
      margin: 0;
      font-family: 'Nanum Gothic', sans-serif;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    h1 {
      margin-bottom: 20px;
      font-size: 2.5rem;
      text-shadow: 0 0 10px #ffd54f;
    }
    textarea {
      width: 100%;
      max-width: 700px;
      height: 300px;
      border-radius: 12px;
      border: none;
      padding: 20px;
      font-size: 1.2rem;
      resize: vertical;
      box-shadow: inset 0 0 15px #ffc10766;
      background-color: #1e1e2a;
      color: #eee;
      outline: none;
      margin-bottom: 20px;
    }
    button {
      background: #ffeb3b;
      color: #222;
      border: none;
      border-radius: 14px;
      padding: 14px 48px;
      font-size: 1.3rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 30px #fdd835cc;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      margin: 5px;
    }
    button:hover {
      background-color: #fdd835;
      box-shadow: 0 0 45px #fdd835ee;
    }
    .button-group {
      display: flex;
      justify-content: center;
      gap: 20px;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDuF64w0S6ZcoXAuhtahlUAhCgAYnOFBXo",
      authDomain: "sermonnote-live.firebaseapp.com",
      projectId: "sermonnote-live",
      storageBucket: "sermonnote-live.firebasestorage.app",
      messagingSenderId: "520754190508",
      appId: "1:520754190508:web:cc4271b1e96e0bed3ee709",
      measurementId: "G-CWDVF5K3HX"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const btnSaveCustom = document.getElementById('btnSaveCustom');
    const btnDownload = document.getElementById('btnDownload');
    const btnShare = document.getElementById('btnShare');
    const customSermon = document.getElementById('customSermon');

    const docId = 'my-sermon';

    btnSaveCustom.addEventListener('click', () => {
      const content = customSermon.value.trim();
      if (!content) {
        alert('설교 내용을 입력해 주세요.');
        return;
      }
      db.collection('sermons').doc(docId).set({ content })
        .then(() => {
          alert('맞춤형 설교 내용이 저장되었습니다!');
        })
        .catch((error) => {
          alert('저장 중 오류 발생: ' + error.message);
        });
    });

    window.addEventListener('DOMContentLoaded', () => {
      db.collection('sermons').doc(docId).get()
        .then((doc) => {
          if (doc.exists) {
            customSermon.value = doc.data().content || '';
          }
        })
        .catch((error) => {
          console.error('불러오기 오류:', error);
        });
    });

    // 다운로드 기능 (텍스트 파일로 저장)
    btnDownload.addEventListener('click', () => {
      const content = customSermon.value.trim();
      if (!content) {
        alert('설교 내용을 입력해 주세요.');
        return;
      }
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sermon.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // 공유 기능 (클립보드 복사)
    btnShare.addEventListener('click', () => {
      const content = customSermon.value.trim();
      if (!content) {
        alert('설교 내용을 입력해 주세요.');
        return;
      }
      navigator.clipboard.writeText(content)
        .then(() => alert('설교 내용이 클립보드에 복사되었습니다!'))
        .catch(() => alert('복사에 실패했습니다.'));
    });
  </script>

</head>
<body>

  <h1>맞춤형 설교 작성</h1>

  <textarea id="customSermon" placeholder="여기에 맞춤형 설교 내용을 입력하세요..."></textarea>

  <div class="button-group">
    <button id="btnSaveCustom">저장하기</button>
    <button id="btnDownload">다운로드</button>
    <button id="btnShare">공유 (복사)</button>
  </div>

</body>
</html>
